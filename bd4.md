消息队列是一种异步的服务间通信方式，是分布式系统中重要的组件，主要解决应用耦合，异步消息，流量削锋等问题，实现高性能，高可用，可伸缩和最终一致性架构。

消息队列的实现：

```
#include <sys/msg.h>
// 创建或打开消息队列：成功返回队列ID，失败返回-1
int msgget(key_t key, int flag);
// 添加消息：成功返回0，失败返回-1
int msgsnd(int msqid, const void *ptr, size_t size, int flag);
// 读取消息：成功返回消息数据的长度，失败返回-1
int msgrcv(int msqid, void *ptr, size_t size, long type,int flag);
// 控制消息队列：成功返回0，失败返回-1
int msgctl(int msqid, int cmd, struct msqid_ds *buf);
```

消息队列（Message Queue）是一种进程间通信或同一进程的不同线程间的通信方式。

消息队列（Message Queue）用于在进程之间传递较小的数据，进程可以向一个或多个消息队列中放入数据（消息），其它进程可以从消息队列中按照各种方式（例如最典型的先进先出FIFO方式）取出消息，从而实现进程间通信。

消息队列是一种生产者消费者模型，生产者生产消息放入队列，等待被消费者消费走。如果消息队列已满，生产者被阻塞，如果队列已空，消费者被阻塞。当然，按照不同设计方式，可能会以通知的方式替代阻塞行为。

消息传递提供一种机制，以便允许进程不必通过共享地址空间来实现通信和同步。对分布式环境（通信进程可能位于通过网络连接的不同计算机），这特别有用。

## 消息队列的特点
---

1. 消息队列是消息的链表,具有特定的格式,存放在内存中并由消息队列标识符标识.

2. 消息队列允许一个或多个进程向它写入与读取消息.

3. 管道和命名管道都是通信数据都是先进先出的原则。

4. 消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取,也可以按消息的类型读取.比FIFO更有优势。

## 相比于 FIFO，消息队列具有以下优点：
---

1. 消息队列可以独立于读写进程存在，从而避免了 FIFO 中同步管道的打开和关闭时可能产生的困难

2. 避免了 FIFO 的同步阻塞问题，不需要进程自己提供同步方法

3. 读进程可以根据消息类型有选择地接收消息，而不像 FIFO 那样只能默认地接收