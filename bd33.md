HTTPS 并不是新协议，而是让 HTTP 先和 SSL（Secure Sockets Layer）通信，再由 SSL 和 TCP 通信，也就是说 HTTPS 使用了隧道进行通信。

通过使用 SSL，HTTPS 具有了加密（防窃听）、认证（防伪装）和完整性保护（防篡改）。

---

某网站拥有用于非对称加密的公钥A、私钥A’。

浏览器像网站服务器请求，服务器把公钥A明文给传输浏览器

浏览器随机生成一个用于对称加密的密钥X，用公钥A加密后传给服务器。

服务器拿到后用私钥A’解密得到密钥X。

这样双方就都拥有密钥X了，且别人无法知道它。之后双方所有数据都用密钥X加密解密。

中间人的确无法得到浏览器生成的密钥B，这个密钥本身被公钥A加密了，只有服务器才有私钥A’解开拿到它呀！然而中间人却完全不需要拿到密钥A’就能干坏事了。

网站在使用HTTPS前，需要向“CA机构”申请颁发一份数字证书，数字证书里有证书持有者、证书持有者的公钥等信息，服务器把证书传输给浏览器，浏览器从证书里取公钥就行了

CA拥有非对称加密的私钥和公钥。

CA对证书明文信息进行hash。

对hash后的值用私钥加密，得到数字签名。

明文和数字签名共同组成了数字证书，这样一份数字证书就可以颁发给网站了。

浏览器验证过程：

拿到证书，得到明文T，数字签名S。

用CA机构的公钥对S解密（由于是浏览器信任的机构，所以浏览器保有它的公钥。详情见下文），得到S’。

用证书里说明的hash算法对明文T进行hash得到T’。

比较S’是否等于T’，等于则表明证书可信。

![](https://upload-images.jianshu.io/upload_images/3944800-d49039226921d0c9.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

### **HTTPS必须在每次请求中都要先在SSL/TLS层进行握手传输密钥吗？**
---

服务器会为每个浏览器（或客户端软件）维护一个session ID，在TSL握手阶段传给浏览器，浏览器生成好密钥传给服务器后，服务器会把该密钥存到相应的session ID下，之后浏览器每次请求都会携带session ID，服务器会根据session ID找到相应的密钥并进行解密加密操作，这样就不必要每次重新制作、传输密钥了！

![](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/How-HTTPS-Works.png)